---
title: "[wilson] 03. 설계 갈아엎기"
date: 2025-08-12 19:59:22 +0900
categories: [project, wilson]
tags: [project, DDD, hexagonal-architecture]
image: /assets/img/project/wilson/wilson.jpg
---

저번 포스팅에서 DDD에 대해 학습하고 제멋대로 바운디드 컨텍스트 나누고 일단 개발 시작했다가 계속해서 이게 맞나? 라는 의문이 들기 시작했다.  
개발을 진행하면 할수록 대단히 잘못하고 있구나를 느꼈고, 더 늦기 전에 설계부터 뜯어고쳐보자.

---

## 뭔가 이상한데?
처음에 생각했던 흐름은 Github Actions로 pr 발생했을 때, Review 컨트롤러에서 받고, service에서 RAG, 프롬프트 작성해서 llm에 리뷰 요청 후 github api로 댓글까지 다는 시나리오였다.  
근데 이런식으로 동작하다보니 review service에서 project 값들 계속해서 조회해야되고, 특히 댓글 작성하는데 user access token도 필요한데 이걸 public dto로 넘겨주면 안되는데?  
그럼 github에 comment 작성은 project에서 하는게 맞겠구나. 근데 처음에 왜 이렇게 설계했지? 라고 생각해보니 review와 project라고 나누다 보니 review 요청부터 comment 작성해서 마무리까지 review 도메인에서 수행해야 한다고 생각했던 것 같고, 이 부분이 잘못됐구나를 깨달았다.  
그래서 리뷰 요청을 받는 controller를 project로 넘기고, comment 작성 또한 project에서 직접 수행하도록 수정하자.  
이렇게 하면 review에서는 유사 코드 조회해서 프롬프트 구성, 리뷰 요청 후 결과를 넘겨주는 것 까지만 수행해서 도메인 별 역할이 더 명확해지는 것 같다.  
돌아보니 어찌보면 당연한건데...시간 참 많이 태웠다;  

---

## 헥사고날 아키텍처로 개발하면서 느낀 점
맨날 계층형으로만 개발하다가 헥사고날 아키텍처를 사용하면서 확실히 장, 단점이 있다고 느꼈다.  
단점부터 말하자면, 코드 양이 확실히 많아진다. 유스케이스와 포트가 중간에 인터페이스로 생기다 보니 어쩔 수 없는 것 같다.  
장점은 확실히 변경할 이유가 적어진다. 특히 도메인 로직은 컨트롤러 혹은 어댑터가 변경된다고 해서 별도의 코드 변경이 없다.  
그리고 만약 팀으로 개발하는 경우, 중간에 낑긴 인터페이스들(유스케이스, 포트)만 정의를 명확하게 해놓으면 분업이 훨씬 수월할 것 같다고 느꼈다.  
브랜치 네이밍도 편하고 양 끝에서 테스트하면서 안쪽으로 합치면 되니까, 관리도 편할 것 같다.  
계층형으로 개발하면 영속성 계층에 계속해서 의존하는 구조다 보니, 구분점? 잡기가 좀 애매했는데 헥사고날 아키텍처는 도메인 로직부터 개발하고, 거기서 유스케이스와 포트가 명확하게 정의만 된다면 나머지는 레고처럼 끼워맞추기만 하면 되는 느낌이다.  
(유스케이스랑 포트 처음에 잘못 만들어놔서 수정하면 양쪽으로 다 바꿔야하는건 똑같긴 하더라...나도 알고싶지 않았다...)
그리고 현재는 모놀리식으로 개발하고 있지만 만약 MSA로 전환한다고 한다면 계층형보다 만배는 수월할 것 같다.  